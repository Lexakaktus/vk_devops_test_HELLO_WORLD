# Система мониторинга Flask-приложения
<!-- [app.py - скрипт на python](src/app.py) -->

## Описание

### Данное решение представляет собой систему мониторинга, которая:
- проверяет доступность Flask-приложения ([app.py](src/app.py)) по HTTP
- пишет результаты в лог-файл
- при недоступности — выполняет автоматический перезапуск
- ограничивает количество рестартов в час
- работает как systemd-таймер, выполняясь каждые N секунд
- автоматически запускается при старте системы
- включает автоматизированный процесс установки и обновления

### Система состоит из трёх основных частей:
* [monitor_app.sh](src/scripts/monitor_app.sh) — скрипт мониторинга
* [monitor_app.conf](src/scripts/monitor_app.conf) — файл конфигурации
* [monitor_app.service](src/scripts/monitor_app.service) и [monitor_app.timer](src/scripts/monitor_app.timer) — юниты systemd
* [install_monitor.sh](src/install_monitor.sh) — автоматический установщик


## Архитектура решения
1. Скрипт мониторинга ([monitor_app.sh](src/scripts/monitor_app.sh))

    Основные функции:
* Проводит HTTP-проверку целевого URL.
* Сравнивает ответ приложения с ожидаемым статус-кодом.
* Ведёт логирование в файл (по умолчанию /var/log/monitor_app.log).
* Ведёт счётчик рестартов в течение часа.
* Перезапускает приложение через systemd-сервис или отдельный скрипт.
* Использует файл-блокировку (flock), чтобы избежать параллельных запусков.
* Конфигурация вынесена в отдельный файл [monitor_app.conf](src/scripts/monitor_app.conf).

2. Файл конфигурации ([monitor_app.conf](src/scripts/monitor_app.conf))

    Позволяет менять параметры мониторинга без редактирования основного скрипта:
* URL для проверки
* ожидаемый HTTP-код
* пути для логов и lock-файла
* как именно перезапускать приложение
* ограничения по количеству рестартов
* путь к curl

3. Запуск каждые N секунд — systemd timer

    Мониторинг запускается через:
- [monitor_app.service](src/scripts/monitor_app.service) 
- [monitor_app.timer](src/scripts/monitor_app.timer)

    Таймер обеспечивает:
* запуск каждые N секунд (OnUnitActiveSec=30)
* автоматический старт при загрузке ОС
* корректное логирование через journalctl
* надёжность по сравнению с cron


4. Автоматическая установка ([install_monitor.sh](src/install_monitor.sh))

    Установщик:

* копирует файлы в правильные каталоги
* делает их исполняемыми
* загружает systemd-юниты
* включает и запускает таймер

Использование (требует sudo-прав):

``` ./install_monitor.sh ```

После этого мониторинг начинает работать автоматически.